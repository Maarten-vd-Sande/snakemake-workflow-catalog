<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css"
    integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.18.1/dist/bootstrap-table.min.css">

  <style>
    #content {
      margin-top: 2em;
      margin-left: auto;
      margin-right: auto;
      width: 90%;
    }

    #logo {
      height: 2em;
      vertical-align: center;
    }

    pre#check-msg {
      overflow: auto;
      max-height: 80vh;
    }

    .navbar a:not(.navbar-brand) {
      color: #007bff !important;
    }
  </style>

  <title>Snakemake workflow catalog</title>
</head>

<body>

  <!-- Image and text -->
  <!-- Image and text -->
  <nav class="navbar navbar-light bg-light">
    <a class="navbar-brand" href="#">
      <img src="logo-snake.svg" id="logo" /> Snakemake workflow catalog
    </a>
    <div class="navbar-nav">
      <div class="navbar-text">A comprehensive catalog of
        <a href="#" data-toggle="modal" data-target="#rule-popup">standards compliant</a>, public, <a
          href="https://snakemake.github.io">Snakemake</a> workflows
      </div>
    </div>
  </nav>

  <div id="content">
    <table id="repos" data-toggle="table" data-pagination="true" data-search="true" data-pagination="true"
      data-sort-name="stargazers_count" data-sort-order="desc">
      <thead>
        <tr>
          <th data-searchable="true" data-sortable="true" data-field="full_name" data-formatter="name_formatter">
            Workflow</th>
          <th data-searchable="true" data-field="description">Description</th>
          <th data-searchable="true" data-field="topics" data-formatter="topics_formatter">Topics</th>
          <th data-field="full_name" data-formatter="qc_formatter">QC</td>
          <th data-sortable="true" data-field="stargazers_count" data_formatter="stargazers_formatter">Stars</th>
          <th data-sortable="true" data-field="subscribers_count" data_formatter="watchers_formatter">Watchers</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>

  <hr />

  <div class="footer">
    <p><small><a href="https://github.com/snakemake">&copy; 2020 The Snakemake team</a></small></p>
    <p><small>This catalog is generated automatically by querying Github APIs; the Snakemake team is not responsible for
        the linked workflows.</small></p>
    <p><small>Source code: <a
          href="https://github.com/snakemake/snakemake-workflow-catalog">https://github.com/snakemake/snakemake-workflow-catalog</a></small>
    </p>
  </div>

  <div class="modal fade" tabindex="-1" role="dialog" id="detail-popup">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Modal title</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <pre id="check-msg"></pre>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" tabindex="-1" role="dialog" id="rule-popup">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Rules for inclusion</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>
            This catalog includes workflows based on the following criteria:
          <ul>
            <li>The workflow is contained in a public <a href="https://github.com">Github</a> repository.</li>
            <li>The repository has a readme, containing the words "snakemake" and "workflow" (case insensitive).</li>
            <li>The repository contains a workflow definition named either <samp>Snakefile</samp> or
              <samp>workflow/Snakefile</samp>.</li>
            <li>If the repository contains a folder <samp>rules</samp> or <samp>workflow/rules</samp> that folder must
              at least contain one file ending on <samp>.smk</samp>.</li>
            <li>The repository is small enough to be cloned into a Github actions job (very large files should be
              handled via Git LFS, so that they can be stripped out during cloning).</li>
            <li>The repository is not blacklisted <a
                href="https://github.com/snakemake/snakemake-workflow-catalog/blob/main/blacklist.txt">here</a>.</li>
          </ul>
          </p>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"
    integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg=="
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
    crossorigin="anonymous"></script>
  <script src="https://unpkg.com/bootstrap-table@1.18.1/dist/bootstrap-table.min.js"></script>

  <script src="data.js"></script>

  <script>
    function name_formatter(full_name) {
      return `<a href="https://github.com/${full_name}">${full_name}</a>`
    }

    function topics_formatter(topics) {
      return topics.map(topic => `<a href="https://github.com/topics/${topic}">${topic}</a>`).join(", ")
    }

    function escapeHtml(unsafe) {
      if (unsafe) {
        return unsafe
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#039;");
      } else {
        return ""
      }
    }

    function check_badge(check, msg) {
      const passed = msg ? 'failed' : 'passed'
      const color = msg ? 'red' : 'green'
      return `
      <a href="#" data-msg="${escapeHtml(msg)}" data-title="${check} errors" data-toggle="modal" data-target="#detail-popup">
        <img src="https://img.shields.io/badge/${check}-${passed}-${color}" />
      </a>
      `
    }

    function qc_formatter(_, repo) {
      return `
      <img src="https://img.shields.io/github/license/${repo.full_name}" /><br />
      <a href="https://github.com/${repo.full_name}/commits"><img src="https://img.shields.io/github/last-commit/${repo.full_name}" /></a><br />
      ${check_badge("linting", repo.linting)}<br />
      ${check_badge("formatting", repo.formatting)}
      `
    }

    function stargazers_formatter(_, repo) {
      return `<a href="https://github.com/${repo.full_name}/stargazers">${repo.stargazers_count}</a>`
    }

    function watchers_formatter(_, repo) {
      return `<a href="https://github.com/${repo.full_name}/watchers">${repo.subscribers_count}</a>`
    }

    $("#repos").bootstrapTable({
      data: data
    })

    $('#detail-popup').on('show.bs.modal', function (event) {
      var source = $(event.relatedTarget) // item that triggered the modal
      var msg = source.data('msg')
      var title = source.data('title')
      var modal = $(this)
      modal.find('.modal-title').text(title)
      modal.find('.modal-body pre').text(msg)
    })
  </script>
</body>

</html>